<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>المحاسبة والمخازن</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase الإصدار الكلاسيكي -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase.js"></script>

  <script src="lang.js"></script>
  <script src="main.js" defer></script>
</head>
<body>
  <div class="side-menu" id="sideMenu">
    <div class="menu-header">
      <img src="logo.png" alt="Logo" class="mini-logo" />
      <h2 data-key="accounting">المحاسبة والمخازن</h2>
    </div>

    <ul class="menu-list">
      <li data-key="orders" id="goOrders">الطلبات</li>
      <li data-key="customers">العملاء</li>
      <li data-key="products">المنتجات</li>
      <li data-key="categories">التصنيفات</li>
      <li data-key="units">الوحدات</li>
      <li data-key="itemCard">بطاقة الصنف</li>

      <li class="dropdown">
        <span class="drop-btn" data-key="inventoryTitle">المخازن ▸</span>
        <ul class="submenu">
          <li data-key="inventoryItems">مواد المخزون</li>
          <li data-key="storagePlaces">أماكن التخزين</li>
          <li data-key="issue">صرف</li>
          <li data-key="production">انتاج</li>
          <li data-key="inventoryCheck">جرد</li>
          <li data-key="transfer">تحويلات</li>
          <li data-key="returnToStore">مرتجع للمخزن</li>
          <li data-key="damagedReturns">مرتجع توالف</li>
        </ul>
      </li>

      <li class="dropdown">
        <span class="drop-btn" data-key="suppliersTitle">الموردون ▸</span>
        <ul class="submenu">
          <li data-key="suppliers">الموردون</li>
          <li data-key="purchase">الشراء</li>
          <li data-key="returnToSupplier">مرتجع للمورد</li>
        </ul>
      </li>

      <li class="dropdown">
        <span class="drop-btn" data-key="adminTitle">الإدارة ▸</span>
        <ul class="submenu">
          <li data-key="pendingStockMoves">حركات مخزون معلقة</li>
          <li data-key="devices">الأجهزة والكاشير</li>
          <li data-key="warehouseStaff">موظفي المخازن</li>
          <li data-key="productionStaff">موظفي الانتاج</li>
          <li data-key="branches">الفروع</li>
          <li data-key="deliveryAreas">مناطق التوصيل</li>
          <li data-key="deliveryPrices">أسعار التوصيل</li>
          <li data-key="discounts">خصومات</li>
          <li data-key="orderTypes">أنواع الطلب وطرق الدفع</li>
        </ul>
      </li>
    </ul>

    <div class="lang-switch">
      <button id="toggleLang">English</button>
    </div>
  </div>

  <div class="main-content">
    <h1 id="pageTitle" data-key="welcomeAccount">مرحبًا بك في المحاسبة والمخازن</h1>
    <p id="statusMsg"></p>
  </div>

  <script>


document.addEventListener("DOMContentLoaded", () => {
  setTimeout(() => {
    if (localStorage.getItem("adminLoggedIn") !== "true") {
      window.location.href = "login.html";
    }
  }, 400); // تأخير بسيط يمنع دخول الحلقة
});

    // ===== Firebase Config =====
    const firebaseConfig = {
      apiKey: "AIzaSyBdDFbWuByBWsDqEmC18nSlIKG6QZ5s0wA",
      authDomain: "fawatirr-75242.firebaseapp.com",
      databaseURL: "https://fawatirr-75242-default-rtdb.firebaseio.com",
      projectId: "fawatirr-75242",
      storageBucket: "fawatirr-75242.firebasestorage.app",
      messagingSenderId: "1059799456100",
      appId: "1:1059799456100:web:d624eb6f98aaee78950271",
      measurementId: "G-7SQXEJQY6Y"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentLang = "ar";
    const toggleLangBtn = document.getElementById("toggleLang");

    function updateLang() {
      document.documentElement.lang = currentLang;
      document.documentElement.dir = currentLang === "ar" ? "rtl" : "ltr";
      const allKeys = document.querySelectorAll("[data-key]");
      allKeys.forEach(el => {
        el.textContent = translations[currentLang][el.dataset.key];
      });
      toggleLangBtn.textContent = currentLang === "ar" ? "English" : "العربية";
    }

    toggleLangBtn.addEventListener("click", () => {
      currentLang = currentLang === "ar" ? "en" : "ar";
      updateLang();
    });

    // القوائم المنسدلة
    document.querySelectorAll(".drop-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        btn.classList.toggle("open");
        btn.nextElementSibling.classList.toggle("show");
      });
    });

    // التحديث المباشر من Firebase
    const sysRef = db.ref("/system/status");
    sysRef.on("value", snapshot => {
      const val = snapshot.val();
      document.getElementById("statusMsg").textContent = val
        ? "✅ النظام متصل ومحدث الآن"
        : "⚠️ لا يمكن تحديث البيانات مؤقتًا";
    });

    updateLang();

    // ✅ الانتقال إلى صفحة الطلبات
document.getElementById("goOrders").addEventListener("click", () => {
  window.location.href = "orders.html";
});

  </script>
</body>
</html>